# 测试目录重组需求文档

## 介绍

本文档定义了 AI 游戏平台测试目录重组的需求。当前项目中，测试文件分散在各个模块的 `tests` 目录中。为了提高测试管理的可维护性和可扩展性，需要将所有测试文件集中到项目根目录下的 `TEST` 目录中，并确保所有测试能够正确执行。

## 术语表

- **TEST 目录**: 项目根目录下的 `TEST/` 目录，用于集中存储所有测试用例
- **模块测试目录**: 各个模块下的 `tests/` 目录（如 `game_server_factory/tests/`）
- **测试脚本**: 用于执行测试的 shell 脚本或 Python 脚本
- **测试用例**: 单个的测试文件（如 `test_api_endpoints.py`）
- **路径映射**: 从原有模块测试目录到 TEST 目录的文件对应关系

## 需求

### 需求 1: 验证 TEST 目录测试执行

**用户故事**: 作为测试工程师，我想验证 TEST 目录下的所有测试用例能否正确执行，以便确保测试迁移的完整性。

#### 验收标准

1. WHEN 执行 `TEST/scripts/run_all_tests.sh` 脚本 THEN 系统 SHALL 运行 TEST 目录下所有模块的测试
2. WHEN 执行特定模块测试脚本（如 `run_component_tests.sh factory`） THEN 系统 SHALL 仅运行该模块的测试
3. WHEN 测试执行完成 THEN 系统 SHALL 生成测试结果报告，包含通过/失败/跳过的统计
4. WHEN 测试执行过程中发生路径错误 THEN 系统 SHALL 记录错误信息并提供修复建议
5. WHEN 所有 TEST 目录下的测试执行成功 THEN 系统 SHALL 返回成功状态码（0）

### 需求 2: 验证路径映射正确性

**用户故事**: 作为开发者，我想确认 TEST 目录中的测试文件能够正确访问源代码和依赖，以便确保测试的有效性。

#### 验收标准

1. WHEN 测试文件导入源代码模块 THEN 系统 SHALL 能够正确解析相对路径
2. WHEN 测试文件访问配置文件或数据文件 THEN 系统 SHALL 能够正确定位这些文件
3. WHEN 测试执行时需要访问环境变量 THEN 系统 SHALL 能够正确读取这些变量
4. WHEN 测试文件之间存在依赖关系 THEN 系统 SHALL 能够正确加载依赖

### 需求 3: 清理原有模块测试目录

**用户故事**: 作为项目维护者，我想清理原有的模块测试目录中已迁移到 TEST 目录的文件，以便保持项目结构的整洁。

#### 验收标准

1. WHEN 确认 TEST 目录中存在对应的测试文件 THEN 系统 SHALL 删除原有模块测试目录中的该文件
2. WHEN 原有模块测试目录变为空目录 THEN 系统 SHALL 删除该空目录
3. WHEN 原有模块测试目录中存在 `conftest.py` 或 `__init__.py` 等配置文件 THEN 系统 SHALL 评估是否需要保留或迁移
4. WHEN 清理完成后 THEN 系统 SHALL 验证所有测试仍能正确执行
5. WHEN 清理过程中发现不匹配的文件 THEN 系统 SHALL 记录警告并保留这些文件

### 需求 4: 更新测试执行脚本

**用户故事**: 作为 CI/CD 工程师，我想更新测试执行脚本以支持新的 TEST 目录结构，以便确保自动化测试流程的正确性。

#### 验收标准

1. WHEN 执行 `run_all_tests.py` THEN 系统 SHALL 从 TEST 目录而非原有模块目录运行测试
2. WHEN 执行模块特定的测试脚本 THEN 系统 SHALL 正确指向 TEST 目录下的对应模块
3. WHEN 测试脚本执行失败 THEN 系统 SHALL 提供清晰的错误信息和调试建议
4. WHEN 测试脚本执行成功 THEN 系统 SHALL 生成统一格式的测试报告

### 需求 5: 文档更新

**用户故事**: 作为文档维护者，我想更新项目文档以反映新的测试目录结构，以便帮助开发者正确使用测试系统。

#### 验收标准

1. WHEN 开发者查看 TEST 目录文档 THEN 系统 SHALL 提供清晰的目录结构说明
2. WHEN 开发者查看测试执行说明 THEN 系统 SHALL 提供正确的命令示例
3. WHEN 开发者查看故障排查指南 THEN 系统 SHALL 包含常见问题和解决方案
4. WHEN 文档中提到文件路径 THEN 系统 SHALL 使用相对于项目根目录的路径

## 非功能需求

### 性能需求

- 所有测试执行时间不应超过原有执行时间的 110%
- 测试脚本启动时间不应超过 5 秒

### 可靠性需求

- 测试执行成功率应达到 100%（所有测试都应通过）
- 测试结果应具有可重复性

### 可维护性需求

- 新增测试文件应能自动被测试脚本发现
- 测试目录结构应易于扩展

## 约束条件

- 不应修改源代码文件的内容
- 不应修改测试文件的内容（仅调整路径）
- 必须保持向后兼容性（原有的测试命令应仍然可用）
- 所有测试必须在迁移后通过

## 相关文件

- `TEST/README.md` - TEST 目录概览
- `TEST/USAGE.md` - 测试使用说明
- `run_all_tests.py` - 主测试执行脚本
- `TEST/scripts/run_all_tests.sh` - 测试运行脚本
- `TEST/scripts/run_component_tests.sh` - 组件测试脚本
